<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gatho - Optimal Gathering Location</title>
    <!-- Add necessary CSS and JavaScript files here -->
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
        }
    </style>
    <script src="https://unpkg.com/react@18/umd/react.development.js" crossorigin></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js" crossorigin></script>
    <script src="https://unpkg.com/babel-standalone@6/babel.min.js"></script>
    <script defer src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBNpV7eq4zRWLwunS7_qe88yyuoiWKMyj0&libraries=places&loading=async"> </script>
</head>
<body>
    <div id="app"></div>

    <script type="text/babel">
        function App() {
            const [state, setState] = React.useState({
                map:null,
            });
            const mapDivRef = React.useRef(document.getElementById('map'));
            const map = React.useRef(null);
            React.useEffect(() => {map.current = state.map}, [state.map]);
            const markers = []
            const routes = []
            var renderers = []
            const key = 'AIzaSyBNpV7eq4zRWLwunS7_qe88yyuoiWKMyj0'
            var directionsService

            function initMap() {
                // Initialize the map
                map.current = new google.maps.Map(mapDivRef.current, {
                    center: {lat: -31.94513, lng: 115.84105},
                    zoom: 12,
                    streetViewControl: false,
                });

                directionsService = new google.maps.DirectionsService()

                addMarker()
                addMarker({lat: -32.01325554689639, lng: 115.75319795732274})

                //add new marker when user clicks on map
                google.maps.event.addListener(map.current, 'click', function(event) {
                    addMarker(event.latLng)
                    //markers.forEach(x=>console.log(x.position.lat(), x.position.lng()))
                });

                mapDivRef.current.style.height = '40vh'
            }
/*

            function calculateRoute(origin,destination) {
                var request = {
                    origin: origin,
                    destination: destination,
                    travelMode: 'DRIVING',
                    unitSystem: google.maps.UnitSystem.METRIC
                };
                directionsService.route(request, function(route, status) {
                    if (status == 'OK') {
                        addRenderer(route)
                        addRoute(origin,destination,route)
                    }
                });
            }

            function latLngToString(latLng) {
                return latLng.lat() + ',' + latLng.lng()
            }

            function addRoute(origin,destination,route){
                console.log(route)
                if (!(latLngToString(origin) in route)){
                    routes[latLngToString(origin)] = {}
                }
                routes[latLngToString(origin)][latLngToString(destination)] = route
            }

            function addRenderer(route) {
                var renderer = new google.maps.DirectionsRenderer({
                    map: map,
                    directions: route,
                    draggable: true,
                    //polylineOptions: {
                    //    strokeColor: 'red'
                    //}
                });
                renderers.push(renderer)
            }

            function removeRenderers() {
                renderers.forEach(renderer => renderer.setMap(null))
                renderers = []
            }

            function addMarker(position=map.getCenter()) {
                var marker = new google.maps.Marker({
                    map: map,
                    position: position,
                    draggable: true,
                });

                // Update the marker position when the user drags it
                google.maps.event.addListener(marker, 'dragend', function() {
                    //marker.position = marker.getPosition();
                    console.log(marker.position.lat(), marker.position.lng())
                });

                google.maps.event.addListener(marker, 'click', function() {
                    removeMarker(marker)
                })
                
                markers.push(marker)
            }

            function removeMarker(marker){
                markers.splice(markers.indexOf(marker),1)
                marker.setMap(null)
            }

            function calculateAllRoutes() {
                const positions = markers.map(marker => marker.position)
                positions.forEach(origin => {
                    positions.forEach(destination => {
                        if (origin !== destination) {
                            calculateRoute(origin,destination)
                        }
                    })
                })
            }

            function calculateOptimalLocation() {
                const positions = markers.map(marker => marker.position)
                origin = positions[0]
                destination = positions[1]
                console.log(origin,destination)
                calculateRoute(origin,destination)
            }
*/
            
            React.useEffect(initMap,[])
            function calculateOptimalLocation(){}
            function calculateAllRoutes(){}
            function removeRenderers(){}
            return
            (
                <div>
                    <header>
                        <h1>Gatho</h1>
                        <h4>Optimal Gathering Location</h4>
                    </header>

                    <main>
                        <button onClick={calculateOptimalLocation}>Calculate Optimal Location</button>
                        <button onClick={calculateAllRoutes}>Calculate All Routes</button>
                        <button onClick={removeRenderers}>Remove Renderers</button>
                        <div id="map"></div>
                    </main>
                </div>
            )
        }
        ReactDOM.render(<App />, document.querySelector("#app"));
    </script>


</body>
</html>

